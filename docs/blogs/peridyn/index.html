<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PeriDyn: Peridynamics Package Written in Julia â€“ Ravinder Bhattoo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ravinder Bhattoo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-research" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Research</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-research">    
        <li>
    <a class="dropdown-item" href="../../research/index.html">
 <span class="dropdown-text">All</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../publications/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blogs/index.html"> 
<span class="menu-text">Blogs</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../../resources/softwares.html">
 <span class="dropdown-text">Softwares</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=lPTdGRMAAAAJ&amp;hl=en"> <i class="bi bi-google scholar" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/ravinderbhattoo"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ravinderbhattoo/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0000-0003-0323-9108"> <i class="bi bi-orcid" role="img">
</i> 
<span class="menu-text"><img width="20" src="https://orcid.org/assets/vectors/orcid.logo.icon.svg" title="ORCID"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.researchgate.net/profile/Ravinder_Bhattoo?ev=hdr_xprf"> <i class="bi bi-research gate" role="img">
</i> 
<span class="menu-text"><img width="20" src="https://help.researchgate.net/hc/theming_assets/01HZPWT1CS5WRP04ZJX0DM6135" title="Research Gate"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec:chap7_env" id="toc-sec:chap7_env" class="nav-link active" data-scroll-target="#sec\:chap7_env">PeriDyn Environment</a></li>
  <li><a href="#sec:chap7_dis" id="toc-sec:chap7_dis" class="nav-link" data-scroll-target="#sec\:chap7_dis">Material Discretization</a></li>
  <li><a href="#sec:chap7_mat" id="toc-sec:chap7_mat" class="nav-link" data-scroll-target="#sec\:chap7_mat">Material Models</a></li>
  <li><a href="#sec:chap7_contact" id="toc-sec:chap7_contact" class="nav-link" data-scroll-target="#sec\:chap7_contact">Contact Models</a></li>
  <li><a href="#sec:chap7_bound" id="toc-sec:chap7_bound" class="nav-link" data-scroll-target="#sec\:chap7_bound">Boundary Conditions</a></li>
  <li><a href="#sec:chap7_solver" id="toc-sec:chap7_solver" class="nav-link" data-scroll-target="#sec\:chap7_solver">Solvers</a></li>
  <li><a href="#sec:chap7_sim" id="toc-sec:chap7_sim" class="nav-link" data-scroll-target="#sec\:chap7_sim">Simulation</a></li>
  <li><a href="#sec:chap7_para" id="toc-sec:chap7_para" class="nav-link" data-scroll-target="#sec\:chap7_para">Parallel Computing</a></li>
  <li><a href="#sec:chap7_io" id="toc-sec:chap7_io" class="nav-link" data-scroll-target="#sec\:chap7_io">Input/Output</a></li>
  <li><a href="#sec:chap7_vis" id="toc-sec:chap7_vis" class="nav-link" data-scroll-target="#sec\:chap7_vis">Visualization</a></li>
  <li><a href="#sec:chap7_exam" id="toc-sec:chap7_exam" class="nav-link" data-scroll-target="#sec\:chap7_exam">Benchmarking PeriDyn models</a></li>
  <li><a href="#sec:chap7_tensile" id="toc-sec:chap7_tensile" class="nav-link" data-scroll-target="#sec\:chap7_tensile">Tensile simulation</a></li>
  <li><a href="#sec:chap7_flexure" id="toc-sec:chap7_flexure" class="nav-link" data-scroll-target="#sec\:chap7_flexure">Flexure simulation</a></li>
  <li><a href="#sec:chap7_impact" id="toc-sec:chap7_impact" class="nav-link" data-scroll-target="#sec\:chap7_impact">Wave propagation simulation</a></li>
  <li><a href="#sec:chap7_impact" id="toc-sec:chap7_impact" class="nav-link" data-scroll-target="#sec\:chap7_impact">Impact simulation</a></li>
  <li><a href="#sec:mlpd" id="toc-sec:mlpd" class="nav-link" data-scroll-target="#sec\:mlpd">Machine learned constitutive relationship</a></li>
  <li><a href="#sec:mlpd_bb" id="toc-sec:mlpd_bb" class="nav-link" data-scroll-target="#sec\:mlpd_bb">Peridynamics simulation with bond based material</a></li>
  <li><a href="#sec:mlpd_ml" id="toc-sec:mlpd_ml" class="nav-link" data-scroll-target="#sec\:mlpd_ml">Machine leanring with PeriDyn</a></li>
  <li><a href="#sec:mlpd_nn" id="toc-sec:mlpd_nn" class="nav-link" data-scroll-target="#sec\:mlpd_nn">Peridynamics simulation with machine learned material</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PeriDyn: Peridynamics Package Written in Julia</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><a href="https://ravinderbhattoo.github.io/PeriDyn">Documentation</a></p>
<p>PeriDyn is a numerical simulation software designed to solve peridynamics problems. It is written in the Julia programming language, and offers a high level of flexibility and speed. PDBenchmark is built on top of the PeriDyn package, which provides a number of predefined material models and benchmark problems. This allows users to quickly set up and run simulations, and compare their results to established benchmarks.</p>
<p>Peridynamics is a nonlocal continuum theory that can describe material failure and fracture without using the traditional concepts of stress and strain. Instead, it models a material as a collection of particles that interact through pairwise forces. These forces depend on the separation between particles, and can be used to simulate a wide range of materials, including brittle and ductile solids, fluids, and granular materials.</p>
<section id="sec:chap7_env" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_env">PeriDyn Environment</h2>
<p>PeriDyn provide <code>Env</code> struct to hold information regarding system state and other parameters. <code>Env</code> struct is passed to the <code>run!</code> <a href="#sec:chap7_sim">(see)</a> function along with solver <a href="#sec:chap7_solver">(see)</a> and other simulation parameters such as number of time steps, file write frequency, and neighbor update interval etc. The <code>Env</code> struct is shown below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mutable struct</span> GeneralEnv</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    id<span class="op">::</span><span class="dt">Int64</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span><span class="op">::</span><span class="dt">AbstractArray{Int64,1}</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    bid<span class="op">::</span><span class="dt">AbstractArray{Int64,1}</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    ghost_atoms<span class="op">::</span><span class="dt">AbstractArray{Int64,1}</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">Int64</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">::</span><span class="dt">AbstractArray{Float64,2}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    v<span class="op">::</span><span class="dt">AbstractArray{Float64,2}</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    f<span class="op">::</span><span class="dt">AbstractArray{Float64,2}</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    p<span class="op">::</span><span class="dt">AbstractArray{Float64,2}</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    volume<span class="op">::</span><span class="dt">AbstractArray{Float64,1}</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    intact0<span class="op">::</span><span class="dt">AbstractArray{Int64, 1}</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    mass<span class="op">::</span><span class="dt">AbstractArray{Float64,1}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    time_step<span class="op">::</span><span class="dt">Int64</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    dt<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    neighs<span class="op">::</span><span class="dt">AbstractArray{Int64,2}</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    boundary_conditions<span class="op">::</span><span class="dt">Any</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    short_range_repulsion<span class="op">::</span><span class="dt">Any</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    material_blocks<span class="op">::</span><span class="dt">Any</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    boundaries<span class="op">::</span><span class="dt">Tuple</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    Collect!<span class="op">::</span><span class="dt">Any</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    Params<span class="op">::</span><span class="dt">Any</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    Out<span class="op">::</span><span class="dt">Any</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It is a mutable struct type and can be updated once created. Instead of default constructor, PeriDyn also provide <code>Env(id::Int64, materials, short_range_repulsion, boundary_conds, dt; state=2, bskin=0.5)</code> where <code>id</code> is environment id, <code>materials</code> is array of material blocks <a href="#sec:chap7_mat">(see)</a> , <code>short_range_repulsion</code> is array of contact models <a href="#sec:chap7_contact">(see)</a> , <code>boundary_conds</code> is array of boundary conditions <a href="#sec:chap7_bound">(see)</a> , and <code>dt</code> is time step. It calculates all the filelds of <code>Env</code> struct under the hood and create an object of type <code>Env</code>. Once <code>Env</code> is created, it can be updated as and when required.</p>
</section>
<section id="sec:chap7_dis" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_dis">Material Discretization</h2>
<p>Peridynamics utilize material point grid to define a material block. Each material point have its properties such as position, velocity, acceleration, volume and density etc. To define such properties of material block, PeriDyn provide <code>GeneralMaterial(y0, v0, x, volume, type, horizon; max_neigh=100, particle_size=0)</code> <a href="#sec:chap7_mat">(see)</a> where <code>y0</code> is initial deformed position, <code>v0</code> is initial velocity, <code>x</code> is reference position, <code>volume</code> is volume, <code>type</code> is type of material and <code>horizon</code> is horizon as defined in peridynamics. To discretize a material block, users can use PDMaterialPoints.jl (<a href="https://github.com/ravinderbhattoo/PDMaterialPoints.jl" class="uri">https://github.com/ravinderbhattoo/PDMaterialPoints.jl</a>) which will provide <code>y0, v0, x, volume, type</code> for <code>GeneralMaterial</code>. Users can also use seperate software to generate files for these inputs and directly load these files in Julia.</p>
</section>
<section id="sec:chap7_mat" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_mat">Material Models</h2>
<p>In peridynamics, a material model defines the constitutive relationship of a material. These constitutive relationship dictates forces between material points on deformation. PeriDyn implements by holding information regarding material model with <code>PeridynamicsMaterial(bid, gen, spc; name="PM")</code> struct, where <code>bid</code> is block id, <code>gen</code> is general material, <code>spc</code> is specific material, and <code>name</code> is name of peridynamics material block. The <code>GeneralMaterial</code> struct holds the information which are common for all the peridynamics material models where as <code>SpecificMaterial</code> holds the information which are specific to constitute relationship of material. The <code>GeneralMaterial</code> struct is given below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> GeneralMaterial</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    y<span class="op">::</span><span class="dt">Array{Float64,2}</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    velocity<span class="op">::</span><span class="dt">Array{Float64,2}</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">Array{Float64,2}</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    volume<span class="op">::</span><span class="dt">Array{Float64,1}</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span><span class="op">::</span><span class="dt">Array{Int64,1}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    particle_size<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    horizon<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    family<span class="op">::</span><span class="dt">Array{Int64,2}</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    intact<span class="op">::</span><span class="dt">BitArray{2}</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    weighted_volume<span class="op">::</span><span class="dt">Array{Float64,1}</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    deformed<span class="op">::</span><span class="dt">Vector{Bool}</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>PeriDyn also provide a <code>GeneralMaterial(y0, v0, x, volume, type, horizon; max_neigh=100, particle_size=0)</code> method which calculates some of the fields under the hood and return a object of type <code>GeneralMaterial</code>. An example of specific material model struct is given below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> BondBasedSpecific <span class="op">&lt;:</span><span class="dt"> SpecificMaterial</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    bond_stiffness<span class="op">::</span><span class="dt">Array{Float64,2}</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    critical_stretch<span class="op">::</span><span class="dt">Array{Float64, 2}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    density<span class="op">::</span><span class="dt">Array{Float64, 1}</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, <code>bond_stiffness</code> is stiffness of bond as defined for micro-brittle-linear-elastic peridynamics material model, <code>critical_stretch</code> is critical stretch and <code>density</code> is density of material. <code>BondBasedSpecific</code> is a concrete subtype of <code>SpecificMaterial</code> which is an abstract type. A list of implemented <code>SpecificMaterial</code> is given below with their method signatures.</p>
<ul>
<li><p><code>BondBasedSpecific(S, critical_stretch, density::Array{Float64, 1})</code></p></li>
<li><p><code>ElastoPlasticSolidSpecific(bulk_modulus::Array{Float64,1}, shear_modulus::Array{Float64,1}, critical_stretch::Array{Float64,1}, density::Array{Float64,1}, sigma_y; criteria = VonMises())</code></p></li>
<li><p><code>OrdinaryStateBasedSpecific(bulk_modulus::Array{Float64, 1}, shear_modulus::Array{Float64,1}, critical_stretch::Array{Float64,1}, density::Array{Float64,1})</code></p></li>
<li><p><code>PairwiseNNSpecific(layers, critical_stretch, density::Array{Float64, 1}; act=Flux.relu)</code></p></li>
<li><p><code>SkipSpecific()</code></p></li>
</ul>
</section>
<section id="sec:chap7_contact" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_contact">Contact Models</h2>
<p>In peridynamics simulation, repulsive interaction between two physical blocks is modeled through a contact model. A contact model defines the repulsive interaction between particles of two physical blocks as well as the repulsive interaction between the particles of the same block which are not connected through peridynamics bond. To model such interactions, PeriDyn offers abstract type <code>RepulsionModel11</code> and <code>RepulsionModel12</code>. Here, <code>RepulsionModel11</code> model interaction between the particles of same block and <code>RepulsionModel12</code> model interaction between the particles of different blocks. PeriDyn package implements the following contact models.</p>
<ul>
<li><p>LJRepulsionModel</p>
<p>It defines the LJ interactions between the particles of peridynamics material blocks using an expression <span class="math inline">\(F(r) = \frac{dV}{dr}\)</span> where <span class="math inline">\(V(r) = 4\epsilon((\frac{\sigma}{r})^{12} - (\frac{\sigma}{r})^6)\)</span>.</p></li>
<li><p>NonLinearRepulsionModel</p>
<p>It uses non-linear spring equation as <span class="math inline">\(F(r) = K r^n\)</span> where <span class="math inline">\(K\)</span> is spring constant and <span class="math inline">\(n\)</span> is exponent.</p></li>
<li><p>LinearRepulsionModel</p>
<p>It is a special case of NonLinearRepulsionModel where exponent is set to 1.</p></li>
</ul>
<p>All contact models can be defined as <code>ModelName(args..., mat1::PM, mat2::PM; distanceX = 5, max_neighs = 200)</code> for inter-block interaction and <code>ModelName(args..., mat1::PM; distanceX = 5, max_neighs = 200)</code> for intra-block interactions. Here, the lookup distance (<code>distanceX</code>) for neighbors is set to a default value of 5 <span class="math inline">\(\times\)</span> the particle size and maximum number of neighbors <code>max_neighs</code> is set to a default value of 200.</p>
<p>To calculate the repulsive force using theses contact model, we use <code>repulsion_force(dr, RepMod::RepulsionModel)</code> where <code>dr</code> is distance between particles and <code>RepMod</code> is repulsion model defined for the particles.</p>
<p>The package also offers <code>short_range_repulsion!(y, f, type, bid, vol, RM)</code> which will mutate the force vector (<code>f</code>) of a given peridynamics environment by adding the repulsive forces. Here, <code>y</code> is updated position of particles, <code>f</code> is force vector, <code>bid</code> is block-id, <code>vol</code> is volume of particles and <code>RM</code> is repulsion model.</p>
</section>
<section id="sec:chap7_bound" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_bound">Boundary Conditions</h2>
<p>To impose external conditions such as constant strain rate, fix boundary, fixed force value and initial projectile velocity â€“ the PeriDyn package use boundary conditions. Here, we define two abstract types <code>BoundaryCondition</code> and <code>BoundaryConditionat0</code>. The boundary condition <code>BoundaryConditionat0</code> is applied only at start so that we can set some of the system values such as initial projectile velocity. The boundary condition <code>BoundaryCondition</code> is applied throughout the whole simulation. All the boundary conditions are concrete subtypes of one of the two abstract boundary conditions. To apply boundary condition during simulation, we use <code>apply_bc!(env, BC::T, ::Type{Val{:position}}) where T &lt;: BoundaryCondition</code> function inside a solver. The solver will apply all boundary conditions in order after each system state update. Note that since it is applied sequentially, a latter boundary condition can override a former boundary condition. A boundary condition is defined as a <code>struct</code> with at least the following fields.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> BoundaryCondition</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    bool<span class="op">::</span><span class="dt">Array{Bool, 1}</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    last<span class="op">::</span><span class="dt">Array{Float64, 2}</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    onlyatstart<span class="op">::</span><span class="dt">Bool</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    xF<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    vF<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, <code>bool</code> defines the boolean array for particle ids where the boundary condition will be applied. <code>last</code> is used to hold the previous state of the particles usually positions. <code>onlyatstart</code> is used for solvers which perform iterations other than the for time evolution. <code>xF</code> function is applied on positions and <code>vF</code> function is applied on velocities when boundary condition is applied. Some of the implemented boundary conditions are as follows:</p>
<ul>
<li><p><code>FixBC(bool; onlyatstart = false)</code></p>
<p><code>FixBC</code> will fix the particle positions from the initial frame. Here, only argument is a boolean array of particle ids and keyword argument is used as described above. It can be used to fix an end of a bar.</p></li>
<li><p><code>ToFroBC(bool, rate, freq; applyafter = 0, onlyatstart = false)</code></p>
<p>Given a velocity rate and frequency, <code>ToFroBC</code> will perform a to and fro motion for the particles. We can also delay the operation by setting <code>applyafter</code> to some desired frame. It can be used to apply a strain rate or constant velocity.</p></li>
<li><p><code>MoveBC(bool, rate; kwargs...)</code></p>
<p><code>MoveBC</code> is a special case of to and fro boundary condition where the frequency is set to infinite explicitly by calling <code>ToFroBC(bool, rate, Inf; kwargs...)</code>. Therefore, it will move the particles at a given rate in a particular direction.</p></li>
<li><p><code>DeltaScaleBC(bool, scale, fixpoint; onlyatstart = false)</code></p>
<p><code>DeltaScaleBC</code> scales the material points about a fixed point. It can be used for quasi-static simulation where we look for the equilibrium position of the system. It is often easier to achieve equilibrium faster from a scaled system state.</p></li>
</ul>
</section>
<section id="sec:chap7_solver" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_solver">Solvers</h2>
<p>The PeriDyn package provides two abstract type for solvers, a) <code>QuasiStaticSolver</code> for quasi-static simulations and b) <code>DynamicSolver</code> for dynamic simulations. It implements <code>QSDrag(step_size, drag; max_iter = 100, x_tol = 1.0e-6, f_tol = 1.0e-6)</code>, here <code>step_size</code> is size of step in gradient descent optimiser and <code>drag</code> is for viscous damping, as a quasi-static solver which iteratively solves for position with equilibrium i.e.&nbsp;net force on all particles should be zero. All <code>solvers &lt;: QuasiStaticSolver</code> are suppose to have three parameters a) <code>max_iter</code>, the maximum number of iteration for finding solutuion for position, b) <code>x_tol</code>, the tolerance for change in position and c) <code>f_tol</code>, the tolerance for net force on particles. For dynamic simulation, PeriDyn provides <code>DSVelocityVerlet()</code> which perform standard velocity-verlet algorithm for time evolution of system. All dynamic solver implementations should be subtype of <code>DynamicSolver</code> and all quasi-static solver implementations should be subtype of <code>QuasiStaticSolver</code>. An <code>apply_solver!</code> function must be defined for all solvers <a href="#sec:chap7_sim">(see)</a> .</p>
</section>
<section id="sec:chap7_sim" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_sim">Simulation</h2>
<p>To run a simulation with environments <a href="#sec:chap7_env">(see)</a> , PeriDyn provide <code>run!</code> function. The <code>run!(envs, N::Int64, solver; filewrite_freq::Int64 = 10,  neigh_update_freq::Int64 = 1, average_prop_freq::Int64 = 1, out_dir::String = "datafile", start_at::Int64 = 0, write_from::Int = 0, ext::Symbol = :jld, max_part = 30)</code> function take, <code>envs</code> (array of environment), <code>N</code> (number of time steps), and <code>solver</code> (solver) as arguments with other keyword arguments. The function performs a loop with <code>N</code> time and updates the system state for all the environments. The <code>run!</code> function mutates the state of <code>envs</code>, and we get an array of updated environments. The <code>simulate!(args...; out_dir="datafile", append_date=true, kwargs...)</code> function also provide similar functionality and it is wrapper over <code>run!</code> function. The <code>run!</code> function calls <code>apply_solver!(apply_solver!(env, solver))</code> function where solver is a subtype of <code>Union{QuasiStaticSolver, DynamicSolver}</code>. Each solver must define <code>apply_solver!</code> function, which implements the solver over environment variables. The <code>apply_solver!</code> mutates the state of the given environment.</p>
</section>
<section id="sec:chap7_para" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_para">Parallel Computing</h2>
<p>In peridynamics, for a given system state, the force calculation is per-particle basis and is independent of the forces on other particles. Therefore, parallel operations can be used to calculate the per-particle force. The force function <code>force_density_T</code> of material models uses <code>map</code> on the out loop and <code>mapreduce</code> on the inner loop during the force density calculation. The <code>map</code> and <code>mapreduce</code> are standard functions of Julia which perform operation in parallel. By default, Julia runs with four threads which can be override by executing <code>julia -t num_threads</code> for interactive session and <code>julia -t num_threads filename.jl</code> for running scripts. The PeriDyn package also uses <code>Threads</code> package for multi-threading of for loops in functions such as <code>cal_family!</code> (calculates the family members within the horizon), <code>update_repulsive_neighs!</code> (which updates the neighbors for the contact as defined in section&nbsp;<a href="#sec:chap7_contact">(see)</a> and <code>weighted_volume</code>. The performance of parallel operations for family calculation is shown in Figure <a href="#fig:chap7_para_perf">1</a> . The tests were performed with three systems with the number of particles 500000, 4000, and 500. As shown in Figure <a href="#fig:chap7_para_perf">1</a> a, b, c â€“ the time taken to compute decreases with the number of threads available for parallel operations. We also plot the time taken vs the size of the system for four threads in Figure <a href="#fig:chap7_para_perf">1</a> . It show linear scaling for <span class="math inline">\(log(T)\)</span> vs <span class="math inline">\(log(N)\)</span> where <span class="math inline">\(T\)</span> is the time and <span class="math inline">\(N\)</span> is system size. The number shown in the figure may vary depending on the system hardware and other parameters.</p>
<figure id="fig:chap7_para_perf" class="figure">
<p>
<img src="time.png" style="width:90.0%" alt="image" class="figure-img"> <span id="fig:chap7_para_perf" label="fig:chap7_para_perf"></span>
</p>
<figcaption>
Figure 1: The performance of parallel operations for family calculation
</figcaption>
</figure>
</section>
<section id="sec:chap7_io" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_io">Input/Output</h2>
<p>The package offers saving of file as text as well as binary using JLD julia package. The <code>write_data(filename; kwargs...)</code> functions is default function for writing simulation trajectories on the disk. It uses file extension as hint and fall back to an appropriate write function. It supports <em>jld</em> and <em>data</em> as valid file extensions. In case of an invalid file extensions, it defaults to <em>jld</em> data format without changing the given file extension. The <code>solver</code> function saves <em>id, type, position, velocity, acceleration, mass, volume</em> and <em>damage</em> to the disk using the <code>write_data(filename; kwargs...)</code> by providing keyword arguments. The default function to write <em>jld</em> files is <code>save</code> function from LJD julia package. It uses <code>save(filename, items...)</code> where items are the data-fields as provided in <code>solver</code> function. In case of <em>data</em> files, <code>write_ovito(filename::String; kwargs...)</code> is the default function which writes Ovito compatible text files according to its <em>data</em> file extension. It is advisable to write <em>jld</em> files during the simulation as writing <em>jld</em> file is much faster as compared to writing <em>data</em> file specially for larger file sizes. The package also provides functions to covert <em>jld</em> files to <em>data</em> files for visualization in Ovito <a href="#sec:chap7_vis">1.10</a> . The <code>jld2ovito(filename::String)</code> writes a new <em>data</em> file with <em>data</em> extensions appended to the given filename. To convert multiple <em>jld</em> files we can use <code>jld2ovito(file, N; start = 0, step = 100)</code> where <code>file</code> is string with a wildcard * for e.g.&nbsp;<code>env_step_*.jld</code>. The function will loop, with local variable <code>i</code>, from <code>start</code> to <code>N</code> with step <code>step</code> and replace the wildcard with <code>i</code>.</p>
</section>
<section id="sec:chap7_vis" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_vis">Visualization</h2>
<p>Visualizing the simulation results of physical system is key to access the validity of the simulations. It also provides insights in the physical phenomenon happening during the simulation. As mentioned in the section&nbsp;<a href="#sec:chap7_io">(see)</a>, PeriDyn simulation files can be converted to Ovito compatible <em>data</em> files for visualization (see Figure <a href="#fig:chap7_vis_sample">3</a>). It is a text file with per particle information of the system. The <code>write_ovito(filename::String; kwargs...)</code> can be used to write files to insert custom data for visualization after preprocessing. The file structure for the <em>data</em> file is shown in Figure <a href="#fig:chap7_datafile">2</a>. Here, line number 1 show the total number of particles in the system, line number 2 show the column names for the data (note that some data column are grouped together under on name for e.g.&nbsp;position will have 3 columns), and remaining lines shows the data values.</p>
<figure id="fig:chap7_datafile" class="figure">
<p>
<img src="data_file.png" style="width:100.0%" alt="image" class="figure-img"> <span id="fig:chap7_datafile" label="fig:chap7_datafile"></span>
</p>
<figcaption>
Figure 2: Data file in XYZ format.
</figcaption>
</figure>
<figure id="fig:chap7_vis_sample" class="figure">
<p>
<img src="vis_sample.png" style="width:100.0%" alt="image" class="figure-img"> <span id="fig:chap7_vis_sample" label="fig:chap7_vis_sample"></span>
</p>
<figcaption>
Figure 3: Visualization in Ovito.
</figcaption>
</figure>
</section>
<section id="sec:chap7_exam" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_exam">Benchmarking PeriDyn models</h2>
<p>To validate the existing models and PeriDyn, we perform test simulations for tensile loading (displacement controlled), flexure loading (displacement controlled), wave propagation (impulse load) and collision of separate material blocks. We compare simulation result with theoretical value qualitatively. Material block is also visualized at different stage of simulation.</p>
</section>
<section id="sec:chap7_tensile" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_tensile">Tensile simulation</h2>
<p><strong>Bar under tensile load (displacement controlled)</strong></p>
<p>A bar with length 7.2, cross-section 4<span class="math inline">\(\times\)</span><code>4 and resolution 0.1 is stretched using both ends of bar. The simulation is performed with a)</code>BondBasedSpecific<code>and b)</code>OrdinaryStateBasedSpecific` material models as shown in Figure <a href="#fig:tensilebar_plots">5</a>. Figure <a href="#fig:tensilebar_fig">4</a> shows the time evolution of damage. List of relevant parameters with arbitrary units are given in the table.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 51%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Length</td>
<td>7.2</td>
</tr>
<tr class="even">
<td>Width</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td>Height</td>
<td>4.0</td>
</tr>
<tr class="even">
<td>Resolution</td>
<td>0.1</td>
</tr>
<tr class="odd">
<td>Poisonâ€™s ratio</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>E (Youngâ€™s modulus)</td>
<td>200.0</td>
</tr>
<tr class="odd">
<td>K (bulk modulus)</td>
<td>133.33</td>
</tr>
<tr class="even">
<td>G (shear modulus)</td>
<td>80.0</td>
</tr>
<tr class="odd">
<td>Density</td>
<td>2000.0</td>
</tr>
<tr class="even">
<td>Critical stretch</td>
<td>0.01</td>
</tr>
<tr class="odd">
<td>Horizon</td>
<td>3<span class="math inline">\(\times\)</span>Resolution = 0.3</td>
</tr>
<tr class="even">
<td>Time step</td>
<td>0.158</td>
</tr>
<tr class="odd">
<td>Bond stiffness</td>
<td><span class="math inline">\(\frac{18K}{\pi \times Horizon^4}\)</span> = 94314.0</td>
</tr>
</tbody>
</table>
<figure id="fig:tensilebar_fig" class="figure">
<figure class="figure">
<img src="tensilebar/tensile_0.png" style="width:200px" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="tensilebar/tensile_1.png" style="width:200px" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="tensilebar/tensile_2.png" style="width:200px" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="tensilebar/tensile_3.png" style="width:200px" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="tensilebar/tensile_4.png" style="width:200px" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="tensilebar/tensile_5.png" style="width:200px" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figcaption>
Figure 4: Bar showing evolution of damage during tensile load simulation.
</figcaption>
</figure>
<figure id="fig:tensilebar_plots" class="figure">
<figure class="figure">
<img src="tensilebar/tensile_bb_vv.png" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="tensilebar/tensile_osb_vv.png" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figcaption>
Figure 5: Normal stress vs strain curve for bar simulation under constant strain rete for a) bond based model and b) ordinary state based model.
</figcaption>
</figure>
<p>As shown in Figure <a href="#fig:tensilebar_plots">5</a>, the Youngâ€™s modulus from simulation is close to the given Youngâ€™s modulus.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Material model</th>
<th>Actual</th>
<th>Simulation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>BondBasedSpecific</code></td>
<td>200.0</td>
<td>190.1</td>
</tr>
<tr class="even">
<td><code>OrdinaryStateBasedSpecific</code></td>
<td>200.0</td>
<td>210.5</td>
</tr>
</tbody>
</table>
</section>
<section id="sec:chap7_flexure" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_flexure">Flexure simulation</h2>
<p><strong>Bar under flexure loading (displacement controlled)</strong></p>
<p>A bar with length 12.4, cross-section 2.0$$2.0 and resolution 0.2 is fixed at both ends and both ends are moved in lateral direction to induce flexure load. The simulation is performed with <code>BondBasedSpecific</code> material model as shown in Figure <a href="#fig:flexure_bb">7</a>. Figure <a href="#fig:flexure_fig">6</a> shows the time evolution of damage. List of relevant parameters with arbitrary units are given in Table <a href="#tab:chap7_exam_fle">[tab:chap7_exam_fle]</a>.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Length</td>
<td>12.4</td>
</tr>
<tr class="even">
<td>Width</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>Height</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>Resolution</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td>Poisonâ€™s ratio</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>E (Youngâ€™s modulus)</td>
<td>200.0</td>
</tr>
<tr class="odd">
<td>K (bulk modulus)</td>
<td>133.33</td>
</tr>
<tr class="even">
<td>G (shear modulus)</td>
<td>80.0</td>
</tr>
<tr class="odd">
<td>Density</td>
<td>2000.0</td>
</tr>
<tr class="even">
<td>Critical stretch</td>
<td>0.01</td>
</tr>
<tr class="odd">
<td>Horizon</td>
<td>3<span class="math inline">\(\times\)</span>Resolution = 0.6</td>
</tr>
<tr class="even">
<td>Time step</td>
<td>0.632</td>
</tr>
<tr class="odd">
<td>Bond stiffness</td>
<td><span class="math inline">\(\frac{18K}{\pi \times Horizon^4}\)</span> = 5894.6</td>
</tr>
<tr class="even">
<td>Flexure stiffness</td>
<td><span class="math inline">\(\frac{12EI}{L^4}\)</span> = 1.67</td>
</tr>
</tbody>
</table>
<figure id="fig:flexure_fig" class="figure">
<figure class="figure">
<img src="flexure/flexure_0.png" width="100%" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="flexure/flexure_1.png" width="100%" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figcaption>
Figure 6: Damage evolution of a bar under flexure load.
</figcaption>
</figure>
<figure class="figure">
<img src="flexure/flexure_bb_vv.png" class="figure-img">
<figcaption>
Figure 7: Lateral force vs displacement curve for bar under flexure load.
</figcaption>
</figure>
<p>As shown in Figure <a href="#fig:flexure_bb">7</a>, the flexural stiffness from simulation is close to the calculated theoretical value.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Material model</th>
<th>Actual</th>
<th>Simulation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>BondBasedSpecific</code></td>
<td>1.67</td>
<td>1.78</td>
</tr>
</tbody>
</table>
</section>
<section id="sec:chap7_impact" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_impact">Wave propagation simulation</h2>
<p><strong>Pressure wave propagation (impulse loading)</strong></p>
<p>A bar with length 21.2, cross-section 2.0$$2.0 and resolution 0.1 is fixed at left end and right end was given initial momentum to induce impulse load. The simulation is performed with <code>BondBasedSpecific</code> material model as shown in Figure <a href="#fig:pulse_plot">9</a>. Figure <a href="#fig:wave_fig">8</a> shows the time evolution of normal stress along the length of bar. List of relevant parameters with arbitrary units are given in Table <a href="#tab:chap7_exam_imp">[tab:chap7_exam_imp]</a> .</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Length</td>
<td>21.2</td>
</tr>
<tr class="even">
<td>Width</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>Height</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>Resolution</td>
<td>0.1</td>
</tr>
<tr class="odd">
<td>Poisonâ€™s ratio</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>E (Youngâ€™s modulus)</td>
<td>20.0</td>
</tr>
<tr class="odd">
<td>K (bulk modulus)</td>
<td>13.33</td>
</tr>
<tr class="even">
<td>G (shear modulus)</td>
<td>8.0</td>
</tr>
<tr class="odd">
<td>Density</td>
<td>2000.0</td>
</tr>
<tr class="even">
<td>Critical stretch</td>
<td>0.01</td>
</tr>
<tr class="odd">
<td>Horizon</td>
<td>3<span class="math inline">\(\times\)</span>Resolution = 0.3</td>
</tr>
<tr class="even">
<td>Time step</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>Bond stiffness</td>
<td>9431.4</td>
</tr>
<tr class="even">
<td>Wave velocity</td>
<td>0.1</td>
</tr>
</tbody>
</table>
<figure id="fig:wave_fig" class="figure">
<figure class="figure">
<img src="pulse/pulse_0.png" width="100%" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="pulse/pulse_1.png" width="100%" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figure class="figure">
<img src="pulse/pulse_2.png" width="100%" class="figure-img">
<figcaption aria-hidden="true">
</figcaption>
</figure>
<figcaption>
Figure 8: Heatmap of pressure wave propagation for a bar under impulse load.
</figcaption>
</figure>
<figure class="figure">
<img src="pulse/pulse_bb_vv.png" class="figure-img">
<figcaption aria-hidden="true">
Figure 9: Time evolution of normal stress at fixed end of a bar after impulse load
</figcaption>
</figure>
<p>As shown in Figure <a href="#fig:pulse_plot">9</a>, the wave velocity from simulation is close to the calculated theoretical value. Time taken by wave to reach the other end is 195$$0.1 = 195.0, therefore wave velocity <span class="math inline">\(\frac{L}{\Delta t}\)</span>= 21.2/195.0 = 0.108.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Material model</th>
<th>Actual</th>
<th>Simulation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>BondBasedSpecific</code></td>
<td>0.100</td>
<td>0.108</td>
</tr>
</tbody>
</table>
</section>
<section id="sec:chap7_impact" class="level2">
<h2 class="anchored" data-anchor-id="sec:chap7_impact">Impact simulation</h2>
<p><strong>Impact (collision of separate blocks)</strong></p>
<p>A disk with radius 25.0, thickness 4.0 and resolution 0.5 is is hit by a projectile. The simulation is performed with <code>BondBasedSpecific</code> material model as shown in Figure <a href="#fig:disk_plot">11</a>. Figure <a href="#fig:disk_fig">10</a> shows the time evolution of damage. List of relevant parameters with arbitrary units are given in the table.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 45%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Disk radius</td>
<td>25.0</td>
</tr>
<tr class="even">
<td>Disk thickness</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td>Disk resolution</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>Projectile radius</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td>Projectile resolution</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>Poisonâ€™s ratio</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>E (Youngâ€™s modulus)</td>
<td>2000.0</td>
</tr>
<tr class="even">
<td>K (bulk modulus)</td>
<td>1333.3</td>
</tr>
<tr class="odd">
<td>G (shear modulus)</td>
<td>800.0</td>
</tr>
<tr class="even">
<td>Disk density</td>
<td>2000.0</td>
</tr>
<tr class="odd">
<td>Projectile density</td>
<td>20000.0</td>
</tr>
<tr class="even">
<td>Disk critical stretch</td>
<td>0.01</td>
</tr>
<tr class="odd">
<td>Projectile critical stretch</td>
<td>0.1</td>
</tr>
<tr class="even">
<td>Horizon</td>
<td>3<span class="math inline">\(\times\)</span>Resolution = 1.5</td>
</tr>
<tr class="odd">
<td>Time step</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>Bond stiffness</td>
<td><span class="math inline">\(\frac{18K}{\pi \times Horizon^4}\)</span> = 1509.0</td>
</tr>
</tbody>
</table>
<p><em>Table: Parameters for simulating an impact of a projectile on a disk.</em></p>
<figure class="figure">
<figure class="figure">
<img src="disk/disk_0.png" style="width:300px" class="figure-img">
<figcaption>
Back
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_b0.png" style="width:300px" class="figure-img">
<figcaption>
Front
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_1.png" style="width:300px" class="figure-img">
<figcaption>
Back
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_b1.png" style="width:300px" class="figure-img">
<figcaption>
Front
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_2.png" style="width:300px" class="figure-img">
<figcaption>
Back
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_b2.png" style="width:300px" class="figure-img">
<figcaption>
Front
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_3.png" style="width:300px" class="figure-img">
<figcaption>
Back
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_b3.png" style="width:300px" class="figure-img">
<figcaption>
Front
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_4.png" style="width:300px" class="figure-img">
<figcaption>
Back
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_b4.png" style="width:300px" class="figure-img">
<figcaption>
Front
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_5.png" style="width:300px" class="figure-img">
<figcaption>
Back
</figcaption>
</figure>
<figure class="figure">
<img src="disk/disk_b5.png" style="width:300px" class="figure-img">
<figcaption>
Front
</figcaption>
</figure>
<figcaption>
Figure 10: Damage evolution of a disk being hit by a projectile.
</figcaption>
</figure>
<figure class="figure">
<img src="disk/damage_disk.png" class="figure-img">
<figcaption>
Figure 11: Damage evolution of a disk being hit by a projectile.
</figcaption>
</figure>
</section>
<section id="sec:mlpd" class="level2">
<h2 class="anchored" data-anchor-id="sec:mlpd">Machine learned constitutive relationship</h2>
</section>
<section id="sec:mlpd_bb" class="level2">
<h2 class="anchored" data-anchor-id="sec:mlpd_bb">Peridynamics simulation with bond based material</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tensile simulation</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># importing packages</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">using</span> <span class="bu">PDBenchmark</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">using</span> <span class="bu">PeriDyn</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="im">using</span> <span class="bu">BSON</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="im">using</span> <span class="bu">Flux</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">42</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># setting paramters</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Es <span class="op">=</span> <span class="fl">70.0</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nu <span class="op">=</span> <span class="fl">0.25</span> <span class="co"># for bond based peridynamics</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  K <span class="op">=</span> Es<span class="op">/</span><span class="fl">3</span><span class="op">/</span>(<span class="fl">1</span><span class="op">-</span><span class="fl">2</span>nu)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  G <span class="op">=</span> Es<span class="op">/</span><span class="fl">2</span><span class="op">/</span>(<span class="fl">1</span><span class="op">+</span>nu)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rho <span class="op">=</span> <span class="fl">2.2</span> <span class="co"># g/cm3</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  wv <span class="op">=</span> <span class="fu">sqrt</span>(Es<span class="op">/</span>rho)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">println</span>(<span class="st">"Wave velocity: "</span>, wv)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cs <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> reso <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> horizon <span class="op">=</span> <span class="fl">3.0</span><span class="op">*</span>reso</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  time_step <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> reso <span class="op">/</span> wv</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  C <span class="op">=</span> <span class="fl">18</span>K<span class="op">/</span>(<span class="cn">pi</span><span class="op">*</span>horizon<span class="op">^</span><span class="fl">4</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define material block</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  gen_mat <span class="op">=</span> PDBenchmark.<span class="fu">NameParam</span>(<span class="op">:</span>GeneralMaterial, (horizon), <span class="fu">Dict</span>(<span class="op">:</span>max_neigh<span class="op">=&gt;</span><span class="fl">150</span>, <span class="op">:</span>skip_bb<span class="op">=&gt;</span><span class="cn">true</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  spc_mat <span class="op">=</span> PDBenchmark.<span class="fu">NameParam</span>(<span class="op">:</span>BondBasedSpecific, ([C], [cs], [rho], ), <span class="fu">Dict</span>(<span class="op">:</span>func<span class="op">=&gt;</span>(s, C) <span class="op">-&gt;</span> C<span class="op">*</span>s))</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define solver</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  solver <span class="op">=</span> <span class="fu">DSVelocityVerlet</span>()</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># setup and clean output directory</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  out_dir <span class="op">=</span> <span class="st">"MLTensileBarBBNL_"</span> <span class="op">*</span> <span class="fu">string</span>(<span class="fu">typeof</span>(solver))</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  try</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">foreach</span>(rm, <span class="fu">filter</span>(<span class="fu">endswith</span>(<span class="st">".data"</span>), <span class="fu">readdir</span>(<span class="st">"./output/"</span><span class="op">*</span>out_dir, join<span class="op">=</span><span class="cn">true</span>)))</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  catch</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      <span class="cn">nothing</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># perform simulation</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> PDBenchmark.<span class="fu">TensileBar</span>(;gen_mat<span class="op">=</span>gen_mat, dt<span class="op">=</span>time_step,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                                  spc_mat<span class="op">=</span>spc_mat, resolution<span class="op">=</span>reso, solver<span class="op">=</span>solver, Steps<span class="op">=</span><span class="fl">1000</span>, out_dir<span class="op">=</span>out_dir, fwf<span class="op">=</span><span class="fl">10</span>, makeplot<span class="op">=</span><span class="cn">true</span>, trueE<span class="op">=</span>Es)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  env, solver, solvef! <span class="op">=</span> PDBenchmark.<span class="fu">stage!</span>(test)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">solvef!</span>(env, solver)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sec:mlpd_ml" class="level2">
<h2 class="anchored" data-anchor-id="sec:mlpd_ml">Machine leanring with PeriDyn</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importing packages</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PeriDyn</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">BSON</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Zygote</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PDMaterialPoints</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">2020</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># adding some zygote rules (not necessary for the task every time)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Zygote</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">add!</span>(a<span class="op">::</span><span class="dt">Nothing</span>, b<span class="op">::</span><span class="dt">Zygote.Grads</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    b</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">add!</span>(a<span class="op">::</span><span class="dt">Zygote.Grads</span>, b<span class="op">::</span><span class="dt">Zygote.Grads</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> a.params</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        a[p] <span class="op">.=</span> a[p] <span class="op">.+</span> b[p]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    a</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">div!</span>(a<span class="op">::</span><span class="dt">Zygote.Grads</span>, i<span class="op">::</span><span class="dt">T</span>) <span class="kw">where</span> T <span class="op">&lt;:</span><span class="dt"> Real</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> a.params</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        a[p] <span class="op">./=</span> i</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    a</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mul!</span>(a<span class="op">::</span><span class="dt">Zygote.Grads</span>, i<span class="op">::</span><span class="dt">T</span>) <span class="kw">where</span> T <span class="op">&lt;:</span><span class="dt"> Real</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> a.params</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        a[p] <span class="op">.*=</span> i</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    a</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters for simulation</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> Es <span class="op">=</span> <span class="fl">70.0</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nu <span class="op">=</span> <span class="fl">0.25</span> <span class="co"># for bond based peridynamics</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> Es<span class="op">/</span><span class="fl">3</span><span class="op">/</span>(<span class="fl">1</span><span class="op">-</span><span class="fl">2</span>nu)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> Es<span class="op">/</span><span class="fl">2</span><span class="op">/</span>(<span class="fl">1</span><span class="op">+</span>nu)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rho <span class="op">=</span> <span class="fl">2.2</span> <span class="co"># g/cm3</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>wv <span class="op">=</span> <span class="fu">sqrt</span>(Es<span class="op">/</span>rho)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Wave velocity: "</span>, wv)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cs <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> reso <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> horizon <span class="op">=</span> <span class="fl">3.0</span><span class="op">*</span>reso</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>time_step <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> reso <span class="op">/</span> wv</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fl">18</span>K<span class="op">/</span>(<span class="cn">pi</span><span class="op">*</span>horizon<span class="op">^</span><span class="fl">4</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co"># read data from simulation</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>Out <span class="op">=</span> PeriDyn.<span class="fu">jld2array</span>(<span class="st">"./output/</span><span class="sc">$</span>(out_dir)<span class="st">/env_1_step_*.jld"</span>, <span class="fl">1000</span>; start<span class="op">=</span><span class="fl">0</span>, step<span class="op">=</span><span class="fl">10</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co"># defien material models</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Out[<span class="fl">1</span>][<span class="op">:</span>position]</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>vol <span class="op">=</span> Out[<span class="fl">1</span>][<span class="op">:</span>volume]</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="op">=</span> Out[<span class="fl">1</span>][<span class="op">:</span>type]</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> x, <span class="fl">0</span><span class="op">*</span>x, x, vol, <span class="kw">type</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>gen_mat <span class="op">=</span> <span class="fu">GeneralMaterial</span>(out<span class="op">...</span>, horizon; max_neigh<span class="op">=</span><span class="fl">150</span>, skip_bb<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="fu">squareplus</span>(x) <span class="op">=</span> <span class="fl">0.5</span><span class="fu">*</span>(x <span class="op">+</span> <span class="fu">sqrt</span>(x<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span>))</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>nn_spc_mat <span class="op">=</span> <span class="fu">PairwiseNNSpecific</span>([<span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">1</span>], [cs], [rho]; act<span class="op">=</span>squareplus)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>nn_mat <span class="op">=</span> <span class="fu">PeridynamicsMaterial</span>(<span class="fu">deepcopy</span>(gen_mat), nn_spc_mat)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="co"># edit default NN model</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">Chain</span>(<span class="fu">Dense</span>(<span class="fl">1</span>, <span class="fl">10</span>, leakyrelu), <span class="fu">Dense</span>(<span class="fl">10</span>, <span class="fl">10</span>, leakyrelu), <span class="fu">Dense</span>(<span class="fl">10</span>, <span class="fl">1</span>, leakyrelu), x<span class="op">-&gt;</span><span class="fl">1000</span><span class="op">*</span>x)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>nn_mat.specific.NNs[<span class="fl">1</span>, <span class="fl">1</span>] <span class="op">=</span> model</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="co"># loss function</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">loss</span>(kk)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    Ns <span class="op">=</span> Zygote.<span class="pp">@ignore</span> <span class="fu">get_Ns</span>()</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> Out[kk][<span class="op">:</span>acceleration] <span class="op">./</span> density</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>((data <span class="op">-</span> <span class="fu">force_density_T</span>(Out[kk][<span class="op">:</span>position], nn_mat; particles<span class="op">=</span>Ns))<span class="op">.^</span><span class="fl">2</span>)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co"># optimiser</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>ps <span class="op">=</span> Flux.<span class="fu">params</span>(nn_mat.specific.NNs[<span class="fl">1</span>, <span class="fl">1</span>])</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> Flux.<span class="fu">Adam</span>()</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>Ns <span class="op">=</span> [<span class="fl">1</span>]</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">get_Ns</span>()</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    Ns</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Training</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10000</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i<span class="op">%</span><span class="fl">10</span><span class="op">==</span><span class="fl">0</span> <span class="op">|</span> i<span class="op">==</span><span class="fl">1</span>)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>        Ns <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">size</span>(y, <span class="fl">2</span>), <span class="fl">10</span>)</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>        nns <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">2</span>)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    gs <span class="op">=</span> <span class="fu">div!</span>(<span class="fu">reduce</span>(add!, ((kk) <span class="op">-&gt;</span> Flux.<span class="fu">gradient</span>(()<span class="fu">-&gt;loss</span>(kk), ps)).(nns)), <span class="fu">length</span>(nns))</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>    Flux.<span class="fu">update!</span>(opt, ps, gs)</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"</span><span class="sc">$</span>i<span class="st">, </span><span class="sc">$</span>(<span class="fu">reduce</span>(<span class="op">+</span>, <span class="fu">loss</span>.(nns))<span class="op">/</span><span class="fu">length</span>(nns))<span class="st">"</span>)</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save model every 100 iteration</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">%</span><span class="fl">100</span><span class="op">==</span><span class="fl">0</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>        BSON.<span class="pp">@save</span> <span class="st">"mymodel.bson"</span> model</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sec:mlpd_nn" class="level2">
<h2 class="anchored" data-anchor-id="sec:mlpd_nn">Peridynamics simulation with machine learned material</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tensile simulation with machine learned material</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># importing packages</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PDBenchmark</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PeriDyn</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">BSON</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Flux</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">42</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># setting paramters</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> Es <span class="op">=</span> <span class="fl">70.0</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nu <span class="op">=</span> <span class="fl">0.25</span> <span class="co"># for bond based peridynamics</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> Es<span class="op">/</span><span class="fl">3</span><span class="op">/</span>(<span class="fl">1</span><span class="op">-</span><span class="fl">2</span>nu)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> Es<span class="op">/</span><span class="fl">2</span><span class="op">/</span>(<span class="fl">1</span><span class="op">+</span>nu)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rho <span class="op">=</span> <span class="fl">2.2</span> <span class="co"># g/cm3</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>wv <span class="op">=</span> <span class="fu">sqrt</span>(Es<span class="op">/</span>rho)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"Wave velocity: "</span>, wv)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cs <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> reso <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> horizon <span class="op">=</span> <span class="fl">3.0</span><span class="op">*</span>reso</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>time_step <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> reso <span class="op">/</span> wv</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fl">18</span>K<span class="op">/</span>(<span class="cn">pi</span><span class="op">*</span>horizon<span class="op">^</span><span class="fl">4</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># define material block</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>gen_mat <span class="op">=</span> PDBenchmark.<span class="fu">NameParam</span>(<span class="op">:</span>GeneralMaterial, (horizon), <span class="fu">Dict</span>(<span class="op">:</span>max_neigh<span class="op">=&gt;</span><span class="fl">150</span>, <span class="op">:</span>skip_bb<span class="op">=&gt;</span><span class="cn">true</span>))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="fu">squareplus</span>(x) <span class="op">=</span> <span class="fl">0.5</span><span class="fu">*</span>(x <span class="op">+</span> <span class="fu">sqrt</span>(x<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span>))</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>spc_mat <span class="op">=</span> PDBenchmark.<span class="fu">NameParam</span>(<span class="op">:</span>PairwiseNNSpecific, ([<span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">1</span>], [cs], [rho]), <span class="fu">Dict</span>(<span class="op">:</span>act<span class="op">=&gt;</span>squareplus))</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># define solver</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> <span class="fu">DSVelocityVerlet</span>()</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># setup and clean output directory</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>out_dir <span class="op">=</span> <span class="st">"MLTensileBarBBNL_"</span> <span class="op">*</span> <span class="fu">string</span>(<span class="fu">typeof</span>(solver))</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>try</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span>(rm, <span class="fu">filter</span>(<span class="fu">endswith</span>(<span class="st">".data"</span>), <span class="fu">readdir</span>(<span class="st">"./output/"</span><span class="op">*</span>out_dir, join<span class="op">=</span><span class="cn">true</span>)))</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>catch</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="cn">nothing</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># perform simulation</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> PDBenchmark.<span class="fu">TensileBar</span>(;gen_mat<span class="op">=</span>gen_mat, dt<span class="op">=</span>time_step,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                                spc_mat<span class="op">=</span>spc_mat, resolution<span class="op">=</span>reso, solver<span class="op">=</span>solver, Steps<span class="op">=</span><span class="fl">1000</span>, out_dir<span class="op">=</span>out_dir, fwf<span class="op">=</span><span class="fl">10</span>, makeplot<span class="op">=</span><span class="cn">true</span>, trueE<span class="op">=</span>Es)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>env, solver, solvef! <span class="op">=</span> PDBenchmark.<span class="fu">stage!</span>(test)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>BSON.<span class="pp">@load</span> <span class="st">"mymodel.bson"</span> model</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>env.material_blocks[<span class="fl">1</span>].specific.NNs[<span class="fl">1</span>, <span class="fl">1</span>] <span class="op">=</span> model</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="fu">solvef!</span>(env, solver)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../about.qmd">
<p>About</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../license.qmd">
<p>License</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../trademark.qmd">
<p>Trademark</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>